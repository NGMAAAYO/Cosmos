{% extends "base.html" %}
{% block title %}上传代码 - Cosmos{% endblock %}
{% block content %}
  <div class="row justify-content-center">
    <div class="col-md-8">
      <h2>上传代码</h2>
      
      {% if user.code_module %}
        <p>代码 (<strong>{{ user.code_module }}</strong>) 已上传</p>
      {% else %}
        <p>还没有上传任何代码</p>
      {% endif %}

      <p>上传的代码应该是包含一个文件夹的zip压缩文件，文件夹内应该有合法的main.py文件。</p>
      <p>请确保代码文件大小不超过10MB。</p>

      <form id="uploadForm" method="post" action="/upload_code" enctype="multipart/form-data">
        <!-- Using a hidden input to hint a max file size of 10 MB (in bytes) -->
        <input type="hidden" name="MAX_FILE_SIZE" value="10485760">
        <div class="mb-3">
          <label for="file" class="form-label">选择代码文件（.zip）</label>
          <input type="file" name="file" class="form-control" id="file" accept=".zip" required>
        </div>
        <button type="submit" class="btn btn-primary">上传</button>
      </form>
      <script>
        document.getElementById('uploadForm').addEventListener('submit', function(e) {
          var fileInput = document.getElementById('file');
          if(fileInput.files.length) {
        if (fileInput.files[0].size > 10 * 1024 * 1024) {
          e.preventDefault();
          alert('文件大小不能超过10MB。');
        }
          }
        });
      </script>
      <button type="button" class="btn btn-secondary mt-3" onclick="window.location.href='/dashboard'">返回主页</button>
    </div>
  </div>
{% endblock %}
